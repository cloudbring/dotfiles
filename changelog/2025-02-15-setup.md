# 2025-02-15: Dotfiles Cleanup and Chezmoi Setup

## Summary

Migrated from an old fork-based dotfiles system to chezmoi with 1Password integration.

## Changes Made

### Shell Configuration (.zshrc)

1. **Lazy-loading implemented** for slow tools:
   - NVM: `nvm`, `node`, `npm`, `npx` now load on first use
   - pyenv: `pyenv`, `python`, `pip`, `python3`, `pip3` now load on first use
   - SDKMAN: `sdk`, `java`, `gradle`, `mvn` now load on first use
   - OpenClaw completion: lazy-loaded via `compdef`

2. **Startup time improved**: 11.8s â†’ 0.74s

3. **Fixed syntax errors**:
   - `fzf_history.zsh`: Removed invalid `local` outside function
   - `neovide.sh`: Fixed `export $VAR` to `export VAR`

4. **Removed broken symlinks**:
   - `_docker` and `_docker-compose` completions (Docker.app was uninstalled)

5. **Disabled neofetch**: Commented out in `.zlogin` (was "scaring the hoes")

6. **Created `~/.hushlogin`**: Suppresses "Last login:" message

### Aliases (aliases.sh)

- Updated to use `eza` (maintained fork of `exa`) instead of `exa`
- Added fallback to `exa` if `eza` not available

### Security

1. **API keys removed from git tracking**:
   - `apikeys.sh` removed from chezmoi
   - Created `apikeys.sh.tmpl` using 1Password templates
   - Keys fetched at apply-time from 1Password

2. **Keys stored in 1Password**:
   - OpenAI vim-chatgpt: field `beo3jwowjawdstjcaxygqn4f3y`
   - OpenAI Neural: field `3mzqrhyspvu7nty5im7p3jvhri`

### Files Tracked by Chezmoi

```
.config/starship.toml
.config/zsh/aliases.sh
.config/zsh/apikeys.sh.tmpl (template)
.config/zsh/completions/1password.sh
.config/zsh/completions/brew.sh
.config/zsh/functions/fzf_history.zsh
.config/zsh/functions/neovide.sh
.config/zsh/functions/pomodoro.function.zsh
.config/zsh/fzf.zsh
.config/zsh/iterm2.zsh
.config/zsh/nvm.zsh
.config/zsh/powerlevel10k.sh
.config/zsh/python.zsh
.gitconfig
.zlogin
.zprofile
.zshrc
```

## Risky Changes

1. **Lazy-loading**: Could break tools that expect immediate availability
   - Mitigation: Wrapper functions pass all arguments correctly

2. **1Password dependency**: API keys now require `op` CLI to be authenticated
   - Mitigation: Template only runs on macOS; fallback could be added

3. **Removed apikeys.sh from tracking**: Existing file in `~/.config/zsh/apikeys.sh` still works
   - Note: Need to manually delete after chezmoi apply

## Old Directory Cleanup

The old `~/.dotfiles` directory (fork of driesvints/dotfiles) was NOT deleted yet.
It contains:
- Old .zshrc (different structure)
- Brewfile
- macOS defaults script (.macos)
- SSH setup script (ssh.sh)

Decision pending on whether to migrate any of these to chezmoi.

## Verification

```bash
# Test shell startup
time zsh -i -c exit
# Should be ~0.7s

# Check aliases work
zsh -i -c 'type ll; type cat; type cd'

# Verify chezmoi status
chezmoi doctor

# Check managed files
chezmoi managed
```
